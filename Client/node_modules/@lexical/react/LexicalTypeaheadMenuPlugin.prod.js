/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';var k=require("@lexical/react/LexicalComposerContext"),n=require("@lexical/utils"),x=require("lexical"),y=require("react"),z="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement?y.useLayoutEffect:y.useEffect;class A{constructor(c){this.key=c;this.ref={current:null};this.setRefElement=this.setRefElement.bind(this)}setRefElement(c){this.ref={current:c}}}
let B=c=>{const a=document.getElementById("typeahead-menu");if(a){var b=a.getBoundingClientRect();b.top+b.height>window.innerHeight&&a.scrollIntoView({block:"center"});0>b.top&&a.scrollIntoView({block:"center"});c.scrollIntoView({block:"nearest"})}};function C(c,a){var b=window.getSelection();if(null===b||!b.isCollapsed)return!1;let e=b.anchorNode;b=b.anchorOffset;if(null==e||null==b)return!1;try{a.setStart(e,c),a.setEnd(e,b)}catch(g){return!1}return!0}
function D(c){let a=null;c.getEditorState().read(()=>{var b=x.$getSelection();if(x.$isRangeSelection(b)){var e=b.anchor;"text"!==e.type?a=null:(b=e.getNode(),b.isSimpleText()?(e=e.offset,a=b.getTextContent().slice(0,e)):a=null)}});return a}
function E(c,a){c=x.$getSelection();if(!x.$isRangeSelection(c)||!c.isCollapsed())return null;var b=c.anchor;if("text"!==b.type)return null;c=b.getNode();if(!c.isSimpleText())return null;b=b.offset;let e=c.getTextContent().slice(0,b);var g=a.matchingString;a=a.replaceableString.length;for(let p=a;p<=g.length;p++)e.substr(-p)===g.substr(0,p)&&(a=p);a=b-a;if(0>a)return null;let q;0===a?[q]=c.splitText(b):[,q]=c.splitText(a,b);return q}
function F(c,a){return 0!==a?!1:c.getEditorState().read(()=>{var b=x.$getSelection();return x.$isRangeSelection(b)?(b=b.anchor.getNode().getPreviousSibling(),x.$isTextNode(b)&&b.isTextEntity()):!1})}function G(c){y.startTransition?y.startTransition(c):c()}
function I(c,a){let b=getComputedStyle(c),e="absolute"===b.position;a=a?/(auto|scroll|hidden)/:/(auto|scroll)/;if("fixed"===b.position)return document.body;for(;c=c.parentElement;)if(b=getComputedStyle(c),(!e||"static"!==b.position)&&a.test(b.overflow+b.overflowY+b.overflowX))return c;return document.body}function J(c,a){c=c.getBoundingClientRect();a=a.getBoundingClientRect();return c.top>a.top&&c.top<a.bottom}
function K(c,a,b,e){let [g]=k.useLexicalComposerContext();y.useEffect(()=>{if(null!=a&&null!=c){let q=g.getRootElement(),p=null!=q?I(q,!1):document.body,f=!1,d=J(a,p),m=function(){f||(window.requestAnimationFrame(function(){b();f=!1}),f=!0);const t=J(a,p);t!==d&&(d=t,null!=e&&e(t))},r=new ResizeObserver(b);window.addEventListener("resize",b);document.addEventListener("scroll",m,{capture:!0,passive:!0});r.observe(a);return()=>{r.unobserve(a);window.removeEventListener("resize",b);document.removeEventListener("scroll",
m)}}},[a,g,e,b,c])}let L=x.createCommand("SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND");
function M({close:c,editor:a,anchorElementRef:b,resolution:e,options:g,menuRenderFn:q,onSelectOption:p}){let [f,d]=y.useState(null);y.useEffect(()=>{d(0)},[e.match.matchingString]);let m=y.useCallback(h=>{a.update(()=>{const l=E(a,e.match);p(h,l,c,e.match.matchingString)})},[c,a,e.match,p]),r=y.useCallback(h=>{const l=a.getRootElement();null!==l&&(l.setAttribute("aria-activedescendant","typeahead-item-"+h),d(h))},[a]);y.useEffect(()=>()=>{let h=a.getRootElement();null!==h&&h.removeAttribute("aria-activedescendant")},
[a]);z(()=>{null===g?d(null):null===f&&r(0)},[g,f,r]);y.useEffect(()=>n.mergeRegister(a.registerCommand(L,({option:h})=>h.ref&&null!=h.ref.current?(B(h.ref.current),!0):!1,x.COMMAND_PRIORITY_LOW)),[a,r]);y.useEffect(()=>n.mergeRegister(a.registerCommand(x.KEY_ARROW_DOWN_COMMAND,h=>{if(null!==g&&g.length&&null!==f){let l=f!==g.length-1?f+1:0;r(l);let u=g[l];null!=u.ref&&u.ref.current&&a.dispatchCommand(L,{index:l,option:u});h.preventDefault();h.stopImmediatePropagation()}return!0},x.COMMAND_PRIORITY_LOW),
a.registerCommand(x.KEY_ARROW_UP_COMMAND,h=>{if(null!==g&&g.length&&null!==f){var l=0!==f?f-1:g.length-1;r(l);l=g[l];null!=l.ref&&l.ref.current&&B(l.ref.current);h.preventDefault();h.stopImmediatePropagation()}return!0},x.COMMAND_PRIORITY_LOW),a.registerCommand(x.KEY_ESCAPE_COMMAND,h=>{h.preventDefault();h.stopImmediatePropagation();c();return!0},x.COMMAND_PRIORITY_LOW),a.registerCommand(x.KEY_TAB_COMMAND,h=>{if(null===g||null===f||null==g[f])return!1;h.preventDefault();h.stopImmediatePropagation();
m(g[f]);return!0},x.COMMAND_PRIORITY_LOW),a.registerCommand(x.KEY_ENTER_COMMAND,h=>{if(null===g||null===f||null==g[f])return!1;null!==h&&(h.preventDefault(),h.stopImmediatePropagation());m(g[f]);return!0},x.COMMAND_PRIORITY_LOW)),[m,c,a,g,f,r]);let t=y.useMemo(()=>({options:g,selectOptionAndCleanUp:m,selectedIndex:f,setHighlightedIndex:d}),[m,f,g]);return q(b,t,e.match.matchingString)}
function N(c,a,b){let [e]=k.useLexicalComposerContext(),g=y.useRef(document.createElement("div")),q=y.useCallback(()=>{const f=e.getRootElement(),d=g.current;if(null!==f&&null!==c){const {left:m,top:r,width:t,height:h}=c.getRect();d.style.top=`${r+window.pageYOffset}px`;d.style.left=`${m+window.pageXOffset}px`;d.style.height=`${h}px`;d.style.width=`${t}px`;d.isConnected||(null!=b&&(d.className=b),d.setAttribute("aria-label","Typeahead menu"),d.setAttribute("id","typeahead-menu"),d.setAttribute("role",
"listbox"),d.style.display="block",d.style.position="absolute",document.body.append(d));g.current=d;f.setAttribute("aria-controls","typeahead-menu")}},[e,c,b]);y.useEffect(()=>{let f=e.getRootElement();if(null!==c)return q(),()=>{null!==f&&f.removeAttribute("aria-controls");let d=g.current;null!==d&&d.isConnected&&d.remove()}},[e,q,c]);let p=y.useCallback(f=>{null!==c&&(f||a(null))},[c,a]);K(c,g.current,q,p);return g}
exports.LexicalNodeMenuPlugin=function({options:c,nodeKey:a,onClose:b,onOpen:e,onSelectOption:g,menuRenderFn:q,anchorClassName:p}){let [f]=k.useLexicalComposerContext(),[d,m]=y.useState(null);p=N(d,m,p);let r=y.useCallback(()=>{m(null);null!=b&&null!==d&&b()},[b,d]),t=y.useCallback(l=>{m(l);null!=e&&null===d&&e(l)},[e,d]),h=y.useCallback(()=>{a?f.update(()=>{const l=x.$getNodeByKey(a),u=f.getElementByKey(a);if(null!=l&&null!=u){const v=l.getTextContent();null!=d&&d.match.matchingString===v||G(()=>
t({getRect:()=>u.getBoundingClientRect(),match:{leadOffset:v.length,matchingString:v,replaceableString:v}}))}}):null==a&&null!=d&&r()},[r,f,a,t,d]);y.useEffect(()=>{h()},[h,a]);y.useEffect(()=>{if(null!=a)return f.registerUpdateListener(({dirtyElements:l})=>{l.get(a)&&h()})},[f,h,a]);return null===d||null===f?null:y.createElement(M,{close:r,resolution:d,editor:f,anchorElementRef:p,options:c,menuRenderFn:q,onSelectOption:g})};
exports.LexicalTypeaheadMenuPlugin=function({options:c,onQueryChange:a,onSelectOption:b,onOpen:e,onClose:g,menuRenderFn:q,triggerFn:p,anchorClassName:f}){let [d]=k.useLexicalComposerContext(),[m,r]=y.useState(null);f=N(m,r,f);let t=y.useCallback(()=>{r(null);null!=g&&null!==m&&g()},[g,m]),h=y.useCallback(l=>{r(l);null!=e&&null===m&&e(l)},[e,m]);y.useEffect(()=>{let l=d.registerUpdateListener(()=>{d.getEditorState().read(()=>{const u=document.createRange(),v=x.$getSelection(),H=D(d);if(x.$isRangeSelection(v)&&
v.isCollapsed()&&null!==H&&null!==u){var w=p(H,d);a(w?w.matchingString:null);null===w||F(d,w.leadOffset)||null===C(w.leadOffset,u)?t():G(()=>h({getRect:()=>u.getBoundingClientRect(),match:w}))}else t()})});return()=>{l()}},[d,p,a,m,t,h]);return null===m||null===d?null:y.createElement(M,{close:t,resolution:m,editor:d,anchorElementRef:f,options:c,menuRenderFn:q,onSelectOption:b})};exports.PUNCTUATION="\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>_:;";
exports.SCROLL_TYPEAHEAD_OPTION_INTO_VIEW_COMMAND=L;exports.TypeaheadOption=A;exports.getScrollParent=I;exports.useBasicTypeaheadTriggerMatch=function(c,{minLength:a=1,maxLength:b=75}){return y.useCallback(e=>{e=(new RegExp("(^|\\s|\\()(["+c+"]((?:[^"+(c+"\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>_:;\\s]){0,")+b+"}))$")).exec(e);if(null!==e){let g=e[1],q=e[3];if(q.length>=a)return{leadOffset:e.index+g.length,matchingString:q,replaceableString:e[2]}}return null},[b,a,c])};
exports.useDynamicPositioning=K
